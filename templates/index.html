<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Google Maps Scraper</title>
    <link rel="stylesheet" href="{{ url_for('static', filename='css/style.css') }}?v=5">
    <!-- MapLibre GL JS CSS -->
    <link rel="stylesheet" href="https://unpkg.com/maplibre-gl@3.6.2/dist/maplibre-gl.css" />
</head>
<body>
    <div class="container">
        <!-- Header -->
        <div class="header">
            <h1>üó∫Ô∏è Google Maps Scraper</h1>
            <p>Extract business data from Google Maps without API keys</p>
        </div>

        <!-- Main Card -->
        <div class="main-card">
            <!-- Input Section -->
            <div class="input-section">
                <h2>Search Configuration</h2>
                
                <!-- Tab Navigation -->
                <div class="tab-navigation">
                    <button class="tab-btn active" data-tab="keyword">Keyword Search</button>
                    <button class="tab-btn" data-tab="url">URL Input</button>
                    <button class="tab-btn" data-tab="file">File Upload</button>
                </div>

                <!-- Keyword Tab -->
                <div id="keywordTab" class="tab-content active">
                    <div class="input-group">
                        <label for="keyword">Keyword</label>
                        <input type="text" id="keyword" placeholder="e.g., restaurants, cafes, plumbers" />
                    </div>

                    <div class="input-group">
                        <label for="location">Location</label>
                        <input type="text" id="location" placeholder="e.g., New York, Miami, 10001" />
                    </div>
                </div>

                <!-- URL Tab -->
                <div id="urlTab" class="tab-content">
                    <div class="input-group">
                        <label for="searchUrl">Google Maps Search URL</label>
                        <input type="text" id="searchUrl" placeholder="https://www.google.com/maps/search/restaurants+10001" />
                        <small class="input-hint">Paste a Google Maps search URL to scrape all businesses from that search</small>
                    </div>

                    <div class="input-group">
                        <label for="businessUrls">Business URLs (Bulk)</label>
                        <textarea id="businessUrls" rows="6" placeholder="https://www.google.com/maps/place/Business+Name/@40.7308,-73.9973,17z
https://www.google.com/maps/place/Another+Business/@40.7308,-73.9973,17z
(One URL per line)"></textarea>
                        <small class="input-hint">Paste multiple Google Maps business URLs (one per line) to scrape specific businesses</small>
                    </div>
                </div>

                <!-- File Upload Tab -->
                <div id="fileTab" class="tab-content">
                    <div class="input-group">
                        <label for="fileUpload">Upload CSV or Excel File</label>
                        <div class="file-upload-wrapper">
                            <input type="file" id="fileUpload" accept=".csv,.xlsx,.xls" />
                            <label for="fileUpload" class="file-upload-label">
                                <span class="file-upload-icon">üìÅ</span>
                                <span id="fileUploadText">Choose file or drag here</span>
                            </label>
                        </div>
                        <small class="input-hint">Upload a CSV or Excel file with columns: keyword, zip_code (or location), and optionally url</small>
                    </div>

                    <div class="file-format-info">
                        <strong>Supported Formats:</strong>
                        <ul>
                            <li><strong>Option 1:</strong> keyword, zip_code (or location) - for keyword searches</li>
                            <li><strong>Option 2:</strong> url - for URL-based scraping</li>
                            <li><strong>Option 3:</strong> Mix both - some rows with keywords, some with URLs</li>
                        </ul>
                        <a href="/download-template" class="download-template-link">üì• Download Template</a>
                    </div>
                </div>

                <button id="startBtn" class="btn-primary">
                    <span class="btn-text">Start Scraping</span>
                    <span class="btn-loader" style="display: none;">
                        <span class="spinner"></span> Scraping...
                    </span>
                </button>
            </div>

            <!-- Status Section -->
            <div id="statusSection" class="status-section" style="display: none;">
                <h2>Scraping Status</h2>
                
                <!-- Currently Scraping Info -->
                <div class="current-scraping-info">
                    <div class="current-business">
                        <span class="label">Currently Scraping:</span>
                        <span id="currentBusiness" class="value">-</span>
                    </div>
                </div>
                
                <!-- Progress Bar -->
                <div class="progress-container">
                    <div class="progress-bar">
                        <div id="progressFill" class="progress-fill"></div>
                    </div>
                    <div class="progress-info">
                        <span id="progressText">0%</span>
                        <span id="progressCount">0 / 0</span>
                    </div>
                </div>

                <!-- Stats and Map Container -->
                <div class="stats-map-container">
                    <!-- Stats Grid -->
                    <div class="stats-grid">
                        <div class="stat-card">
                            <div class="stat-label">Active Proxy</div>
                            <div id="currentProxy" class="stat-value">-</div>
                        </div>
                        <div class="stat-card success">
                            <div class="stat-label">Scraped</div>
                            <div id="scrapedCount" class="stat-value">0</div>
                        </div>
                        <div class="stat-card danger">
                            <div class="stat-label">Failed</div>
                            <div id="failedCount" class="stat-value">0</div>
                        </div>
                    </div>
                    
                    <!-- Live Map -->
                    <div class="map-container">
                        <div class="map-header">
                            <span>üó∫Ô∏è Live Scraping Map</span>
                        </div>
                        <div id="scrapingMap"></div>
                        <div class="map-legend">
                            <div class="legend-item"><span class="legend-dot grey"></span> Waiting</div>
                            <div class="legend-item"><span class="legend-dot yellow"></span> Scraping</div>
                            <div class="legend-item"><span class="legend-dot green"></span> Success</div>
                            <div class="legend-item"><span class="legend-dot red"></span> Failed</div>
                        </div>
                    </div>
                </div>

                <!-- Live Log -->
                <div class="log-container">
                    <div class="log-header">
                        <span>üìã Live Activity Log</span>
                        <button id="clearLogBtn" class="btn-clear">Clear</button>
                    </div>
                    <div id="liveLog" class="log-content"></div>
                </div>
            </div>

            <!-- Results Section -->
            <div id="resultsSection" class="results-section" style="display: none;">
                <h2>Scraped Results</h2>
                
                <div class="results-header">
                    <span id="totalResults" class="results-count">0 businesses found</span>
                    <button id="downloadBtn" class="btn-download">
                        üì• Download CSV
                    </button>
                </div>

                <div class="table-container">
                    <table id="resultsTable">
                        <thead>
                            <tr>
                                <th>Status</th>
                                <th>Business Name</th>
                                <th>Phone</th>
                                <th>Email</th>
                                <th>Rating</th>
                                <th>Website</th>
                            </tr>
                        </thead>
                        <tbody id="resultsBody">
                        </tbody>
                    </table>
                </div>
            </div>

            <!-- Completion Message -->
            <div id="completionMessage" class="completion-message" style="display: none;">
                <div class="success-icon">‚úì</div>
                <h3>Scraping Completed!</h3>
                <p>Your data is ready to download</p>
            </div>
        </div>
    </div>

    <!-- MapLibre GL JS -->
    <script src="https://unpkg.com/maplibre-gl@3.6.2/dist/maplibre-gl.js"></script>
    <script src="{{ url_for('static', filename='js/app.js') }}?v=5"></script>
</body>
</html>
